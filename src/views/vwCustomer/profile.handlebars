{{#section 'css'}}
<style>
    .avatar-circle {
        width: 100px;
        height: 100px;
        background-color: #2d6bfd;
        color: white;
        border-radius: 50%;
        font-size: 40px;
        font-weight: 700;
        position: absolute;
        top: 20px;
        left: 10px;
    }

    .sidebar-section {
        background: white;
        border-radius: 30px;
        padding: 40px 20px;
        border: 3px solid #2d6bfd;
        height: fit-content;
        position: sticky;
        top: 20px;
    }

    .username-title {
        font-size: 1.2rem;
        font-weight: 800;
        color: #6c757d;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .username-subtitle {
        font-size: 1.2rem;
        font-weight: 700;
        color: #212529;
        margin-bottom: 30px;
    }

    .nav-sidebar {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 40px;
        padding: 0;
        list-style: none;
    }

    .nav-sidebar .nav-link {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        color: #495057;
        padding: 15px 20px;
        border-radius: 15px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        text-decoration: none;
    }

    .nav-sidebar .nav-link i {
        font-size: 1.2rem;
    }

    .nav-sidebar .nav-link:hover {
        background: #f8f9fa;
        color: #2d6bfd;
        transform: translateX(5px);
    }

    .nav-sidebar .nav-link.active {
        background-color: #2d6bfd;
        color: white;
    }

    .content-section {
        background: white;
        border-radius: 20px;
        border: 3px solid #2d6bfd;
        overflow: hidden;
        margin-bottom: 100px;
    }

    .content-header {
        background-color: #2d6bfd;
        padding: 20px 30px;
        border-bottom: 3px solid #2d6bfd;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .content-title {
        font-family: 'Abhaya Libre', serif;
        font-size: 1.25rem;
        font-weight: 700;
        color: white;
    }

    .content-body {
        padding: 30px 40px;
    }

    .form-label-page {
        font-weight: 600;
        font-size: 0.8rem;
        margin-bottom: 10px;
        color: #495057;
        display: block;
        letter-spacing: 0.5px;
    }

    .custom-input-page {
        border: 2px solid #dee2e6;
        border-radius: 20px;
        padding: 12px 20px;
        font-weight: 500;
        background-color: #f8f9fa;
    }

    .custom-input-page:focus {
        border-color: #0d6efd;
        background-color: white;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
    }

    .custom-input-page:disabled {
        background-color: #e9ecef;
        cursor: not-allowed;
        color: #6c757d;
    }

    footer#contact {
        display: none;
    }
</style>
{{/section}}

<div class="container-fluid my-5">
    <div class="row px-4">
        <!-- Sidebar Navigation -->
        <a href="/" class="text-dark text-decoration-none mb-4 d-inline-block">
                <i class="bi bi-arrow-left fs-4 me-2"></i> Back to Home
            </a>
        <div class="col-lg-3 col-md-4 mb-4">
            <div class="sidebar-section">
                <div class="text-center">
                    <div class="avatar-circle mx-auto">
                        {{getInitial authUser.full_name}}
                    </div>
                    <div class="username-title">CUSTOMER</div>
                    <div class="username-subtitle">{{authUser.full_name}}</div>
                </div>

                <ul class="nav-sidebar">
                    <li>
                        <a href="/profile" class="nav-link active">
                            <i class="bi bi-person-circle me-3"></i> Personal Info
                        </a>
                    </li>
                    <li>
                        <a href="/pets" class="nav-link">
                            <i class="bi bi-paw-fill me-3"></i> Pet List
                        </a>
                    </li>
                    <li>
                        <a href="/appointments" class="nav-link">
                            <i class="bi bi-calendar-check-fill me-3"></i> Appointments
                        </a>
                    </li>
                    <li class="mt-4 pt-4 border-top">
                        <form action="/signout" method="post">
                            <button type="submit" class="nav-link text-danger w-100 text-start border-0 bg-transparent">
                                <i class="bi bi-box-arrow-right me-3"></i> Log Out
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-lg-9 col-md-8">

            {{!-- Success/Error Messages --}}
            {{#if success}}
            <div class="alert alert-success alert-dismissible fade show rounded-3 mb-4" role="alert">
                {{#if (eq success 'updated')}}
                <i class="bi bi-check-circle me-2"></i> Profile updated successfully!
                {{/if}}
                {{#if (eq success 'password_changed')}}
                <i class="bi bi-check-circle me-2"></i> Password changed successfully!
                {{/if}}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {{/if}}

            {{#if error}}
            <div class="alert alert-danger alert-dismissible fade show rounded-3 mb-4" role="alert">
                {{#if (eq error 'wrong_password')}}
                <i class="bi bi-exclamation-circle me-2"></i> Current password is incorrect!
                {{/if}}
                {{#if (eq error 'password_mismatch')}}
                <i class="bi bi-exclamation-circle me-2"></i> New passwords do not match!
                {{/if}}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {{/if}}

            {{!-- Profile Form --}}
            <div class="content-section">
                <div class="content-header">
                    <h5 class="content-title mb-0">Personal Information</h5>
                </div>
                <div class="content-body">
                    <form id="profileForm" method="POST" action="/profile/update">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label-page">Full Name</label>
                                <input type="text" name="full_name" class="form-control custom-input-page"
                                    value="{{user.full_name}}" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label-page">Email Address</label>
                                <input type="email" class="form-control custom-input-page" value="{{user.email}}" disabled>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label-page">Phone Number</label>
                                <input type="tel" name="phone" class="form-control custom-input-page" value="{{user.phone}}"
                                    placeholder="Enter phone number">
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label-page">Home Address</label>
                                <input type="text" name="address" class="form-control custom-input-page" value="{{user.address}}"
                                    placeholder="Enter address">
                            </div>
                        </div>

                        <div class="text-end mt-4 pt-3 border-top">
                            <button type="submit" class="btn btn-dark fw-bold px-5 rounded-pill">
                                <i class="bi bi-check-circle me-1"></i> SAVE CHANGES
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{{!-- Change Password Modal --}}
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 border-2" style="border-color: #dee2e6;">
            <div class="modal-header" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-bottom: 2px solid #dee2e6;">
                <h5 class="modal-title fw-bold" id="changePasswordLabel"><i class="bi bi-shield-lock me-2"></i>CHANGE PASSWORD</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <form method="POST" action="/profile/password">
                    <div class="mb-3">
                        <label class="form-label-page">Current Password</label>
                        <input type="password" name="current_password" class="form-control custom-input-page" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label-page">New Password</label>
                        <input type="password" name="new_password" class="form-control custom-input-page" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label-page">Confirm New Password</label>
                        <input type="password" name="confirm_password" class="form-control custom-input-page" required>
                    </div>
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-danger fw-bold px-5">
                            <i class="bi bi-check-circle me-1"></i> CHANGE PASSWORD
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>